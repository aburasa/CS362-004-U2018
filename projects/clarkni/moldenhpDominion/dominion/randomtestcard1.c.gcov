        -:    0:Source:randomtestcard1.c
        -:    0:Graph:randomtestcard1.gcno
        -:    0:Data:randomtestcard1.gcda
        -:    0:Runs:2
        -:    0:Programs:1
        -:    1:/* ============================================================
        -:    2: * CS362-400 - Summer 2018
        -:    3: * Mui Clark
        -:    4: * Assignment 4 - Random test generator
        -:    5: *              Card used: council_room
        -:    6: * Reference: testCard code given in the course github repo &
        -:    7: *            class notes
        -:    8: * ============================================================
        -:    9:*/
        -:   10:
        -:   11:#include "dominion.h"
        -:   12:#include "dominion_helpers.h"
        -:   13:#include "rngs.h"  //random number generator
        -:   14:#include <string.h>
        -:   15:#include <stdlib.h>
        -:   16:#include <assert.h>
        -:   17:#include <stdio.h>
        -:   18:#include <time.h>
        -:   19:#include <math.h>
        -:   20:
        -:   21:
        -:   22:// Counter variables to test failure rates
        -:   23:int cardEffectFail = 0;
        -:   24:int discardCardFail = 0;
        -:   25:int drawCardFail = 0;
        -:   26:int deckHandCountFail = 0;
        -:   27:int numBuysFail = 0;
        -:   28:int otherPlayerDeckHandFail = 0;
        -:   29:
    40000:   30:void council_roomCardCheck(int p, struct gameState *postgame){
        -:   31:    //variables for cardEffect and drawing cards
        -:   32:    int r, s, t, u, v, w, x;
        -:   33:
        -:   34:    struct gameState pregame; //for manual test
        -:   35:
        -:   36://copy game to pregame state
    40000:   37:    memcpy (&pregame, postgame, sizeof(struct gameState));
    40000:   38:    int bonus = 0;  //set starting bonus to 0
        -:   39:
        -:   40://use council_room card to call the cardEffect function
    40000:   41:    r = cardEffect(council_room, 0,0,0, postgame, 0, &bonus);
        -:   42:
        -:   43://drawCard calls
    40000:   44:    s = drawCard(p,&pregame);
    40000:   45:    t = drawCard(p, &pregame);
    40000:   46:    u = drawCard(p, &pregame);
    40000:   47:    v = drawCard(p, &pregame);
        -:   48:
    40000:   49:    pregame.numBuys++;
        -:   50:
        -:   51://discardCard call
    40000:   52:   x = discardCard(0, p, &pregame, 0);
        -:   53:
        -:   54: //other players draw a card
   159963:   55:   for(int i = 0; i < pregame.numPlayers; i++){
   119963:   56:   		if(i != p){
    79963:   57:   			w = drawCard(i, &pregame);
    79963:   58:   			if(w == -1 && pregame.deckCount[i] != 0){
    #####:   59:   				drawCardFail++;
        -:   60:   			}
        -:   61:   		}
        -:   62:   }
        -:   63:
        -:   64://values of handCount and deckCount
    40000:   65:    int postHandCount = postgame->handCount[p];
    40000:   66:    int postDeckCount = postgame->deckCount[p];
    40000:   67:    int preHandCount = pregame.handCount[p];
    40000:   68:    int preDeckCount = pregame.deckCount[p];
        -:   69:
        -:   70://check for numBuys
    40000:   71:    if(pregame.numBuys != postgame->numBuys)
    #####:   72:    	numBuysFail++;
        -:   73:
        -:   74:
        -:   75://conditionals to check if any drawCards failed for each of the drawCard calls
    40000:   76:    if(s == -1 && pregame.deckCount[p] != 0)
    #####:   77:        drawCardFail++;
        -:   78:
    40000:   79:    if(t == -1 && pregame.deckCount[p] != 0)
    #####:   80:        drawCardFail++;
        -:   81:
    40000:   82:    if(u == -1 && pregame.deckCount[p] != 0)
    #####:   83:        drawCardFail++;
        -:   84:
    40000:   85:    if(v == -1 && pregame.deckCount[p] != 0)
    #####:   86:        drawCardFail++;
        -:   87:
        -:   88://conditional to check if cardEffect and/or discardCard fails
    40000:   89:    if(!(r == 0 && x == 0)){
    #####:   90:        if(r){
    #####:   91:            cardEffectFail++;
        -:   92:        }
    #####:   93:        if(x){
    #####:   94:            discardCardFail++;
        -:   95:        }
        -:   96:    }
        -:   97:
        -:   98://check handCount and deckCounts -> they should match
        -:   99:
    40000:  100:    if(!(postHandCount == preHandCount && postDeckCount == preDeckCount)){
    39999:  101:        deckHandCountFail++;
        -:  102:    }
        -:  103:
        -:  104:// check for other players' hand and deck counts matching
   159963:  105:    for (int i = 0; i < pregame.numPlayers; i++) {
   119963:  106:        if (i != p) {
   159926:  107:            if (!(postgame->handCount[i] == pregame.handCount[i] &&
    79963:  108:                  postgame->deckCount[i] == pregame.deckCount[i])) {
    #####:  109:                      otherPlayerDeckHandFail++;
        -:  110:            }
        -:  111:        }
        -:  112:    }
        -:  113:
    40000:  114:}
        -:  115:
        -:  116://random test harness
        -:  117:
        2:  118:int main(){
        -:  119:
        2:  120:    printf(" Testing Council_room card\n====================\n");
        2:  121:    printf(" RANDOM TESTS\n==========================\n");
        -:  122:
        2:  123:    int iteration = 20000; 
        2:  124:    int totPlayers[] = {2,3,4};
        -:  125:    struct gameState game;
        2:  126:    srand(time(NULL));
        -:  127:
        -:  128:    //random initialization of game state
        -:  129:
    40002:  130:    for (int n = 0; n < iteration; n++){
1052040000:  131:        for (int i = 0; i < sizeof(struct gameState); i++){
1052000000:  132:            ((char*)&game)[i] = floor(Random() * 256);
        -:  133:        }
        -:  134:
        -:  135:        //random values for each category
    40000:  136:        game.numPlayers = totPlayers[rand() % 3];
    40000:  137:        game.numBuys = 1;
    40000:  138:        int player = game.numPlayers - 2;
    40000:  139:        game.playedCardCount = floor(Random() * (MAX_DECK-1));
        -:  140:
        -:  141://variables to assign for other players
    40000:  142:        int deckCount = floor(Random() * MAX_DECK);
    40000:  143:        int handCount = floor(Random() * MAX_HAND);
    40000:  144:        int discardCardCount = floor(Random() * MAX_DECK);
    40000:  145:        game.whoseTurn = player;
        -:  146:
        -:  147://set other players hand and deck count
   159963:  148:      for (int i = 0; i < game.numPlayers; i++) {
   119963:  149:            game.deckCount[i] = deckCount;
   119963:  150:            game.handCount[i] = handCount;
   119963:  151:            game.discardCount[i] = discardCardCount;
        -:  152:        }  
        -:  153:       
        -:  154:      //call for council_room test function
    40000:  155:      council_roomCardCheck(player, &game);
        -:  156:    }
        -:  157:
        2:  158:    int totalFailures = cardEffectFail + drawCardFail + deckHandCountFail + discardCardFail + numBuysFail;
        -:  159:
        2:  160:    printf("\n RESULTS\n===============\n");
        2:  161:    printf("TESTS PASSED: %d\n", iteration - totalFailures);
        2:  162:    printf("TESTS FAILED: %d\n", totalFailures);
        -:  163:
        -:  164:    //function failed report
        2:  165:    if(totalFailures == 0){
    #####:  166:        printf("ALL RANDOM TESTS PASSED FOR Council_room\n");
        -:  167:    }
        -:  168:    else{
        2:  169:        printf("Num times drawCard function calls failed: %d\n", drawCardFail);
        2:  170:        printf("Num times discardCard function calls failed: %d\n", discardCardFail);
        2:  171:        printf("Num times cardEffect function calls failed: %d\n", cardEffectFail);
        2:  172:        printf("Hand and deck count mismatch: %d\n", deckHandCountFail);
        2:  173:        printf("numBuys count mismatch: %d\n", numBuysFail);
        2:  174:        printf("Hand and deck count mismatch for other player: %d\n", otherPlayerDeckHandFail);
        -:  175:
        2:  176:        printf (" COUNCIL_ROOM RANDOM TESTS FAILED: %d\n", totalFailures);
        -:  177:    }
        -:  178:
        2:  179:    return 0;
        -:  180:}
        -:  181:
